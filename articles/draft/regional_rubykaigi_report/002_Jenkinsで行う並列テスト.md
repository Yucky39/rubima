# Jenkinsで行う並列テスト
## 山本 和久

前回の岡山Ruby会議に続いて、テストについてのお話を聞かせてくれる株式会社リゾームの山本さんの講演です。  
  
山本さんは2011年7月に開催された RubyKaigi 2011 に参加してテストに対する意識が高くなり、担当しているプロジェクトにテスト環境を導入して開発を行っていました。しかし、プロジェクトが進行するにつれてテストコードが膨らんでしまい、テストに時間がかかるようになってしまいました。  
  
「テストが遅いので、ローカルのマシンでテストを行うと開発の妨げになる…」。  
  
参加者たちも「よくあることだ」と思いながら傾聴していましたが、山本さんはテストが開発の妨げになることを防ぐために、次のことを始めたと話しました。  
・parallel_tests の利用  
・Jenkins をインストールしたテスト用マシンでのテストの実行    
テストを複数のプロセスで実行する Gem である parallel_tests を利用してテストにかかる時間を短縮させて、あらかじめ決められた処理を自動に行う Jenkins をインストールしたマシンでテストを行うことで、開発の妨げにならないようにと考えたそうです。これでしばらくは快適に開発が行えるようになりましたが、さらにプロジェクトが進行するとテストコードがもっと膨らんで、またもテストに時間がかかるようになりました。そこで、山本さんは複数マシンで並列にテストを実行することを考えました。Jenkins で並列にテストを行える運用にするには、次のことをしっかりと決めておかないといけないと話しました。  
・Jenkins のビルドパイプライン  
・テストコードの分割方法  
・開発用ブランチからリリース用ブランチに push するルール  
Jenkins のビルドパイプラインについてはデモ画面を見せながら、山本さんが取り組んできたことをわかりやすく説明しました。また「全てのテストが同時に終わるようにテストコードを分割する」「全てのテストが通っていないとリリース用ブランチに push できないようにする」と並列にテストを行うときに大事になる考えを話しました。  
  
問題に遭遇するたびに改善策を探していき、「快適に開発が行えるようにしたい」という想いが伝わってくるお話でした。Ajaxのタイムラグで時々失敗してしまうテストがある問題や、複数のテストが同時に実行されてときに結果が混ざって見にくくなってしまう問題が残っているので、今後はそれらを改善したいと話しました。
