# Railsアプリのセキュリティ対策入門
## 大垣 靖男

PHP界で有名な大垣さんがなんと岡山Ruby会議に登場です。セキュリティの専門家でもある大垣さんにRailsアプリのセキュリティ対策について語って頂きました。

## 一般的なお話
Railsに限らず一般的なITセキュリティのお話をして頂きました。
ITセキュリティの3要素として機密性・完全性・可用性の3つがあげられます。これを順守するために次のサイクルを回す必要があります。

1. リスクの識別
1. 緩和策の選別
1. 緩和策の導入
1. 状態の検査
1. 1に戻る
 
よくある勘違いとして「セキュリティは完璧でなければならない」という意見がありますがリスク管理を行い、許容できるレベルまでの対策を行うことが大切とのことです。そのための指標として法律や標準、ベストプラクティスにならうことが重要です。

## Railsアプリのセキュリティ
Webアプリの基本構造は次の3つの層に分かれます。

- 入力
- 処理
- 出力

この中でも脆弱性が起きやすいのは入力と出力です。後述のSANS/CWE TOP25 Monster Mitigationの#1と#2にも記述されています。

Rails4から採用された仕組みとしてStrong Parameterがあります。Controllerでバリデーション(※)を行うことで、Modelより入力に近い場所でチェックを行うことが可能となりました。これはModelでのバリデーションと組み合わせて使用することで「多重のセキュリティ・フェイルセーフ」になりより強固なアプリケーションを構築することができます。

## JavaScirptインジェクション
クロスサイトスクリプティングの対策になります。 JavaScriptインジェクションは侵入経路が多岐にわたる上、クライアントで実行されると全くログに残らないため非常に厄介です。基本的にはRails標準のHelperを使うことが大切とのことです。

## CSRFとセッション
Rails4もRails3と同様のCSRF対策が施されています。ただおかしなリクエストが来た時の挙動が変更になっているので注意が必要とのことです。

- Rails4 例外
- Rails3 セッションをリセット

またセッションIDはログイン後にreset_sessionでリセットすることが望ましいそうです。

## 必ず参照して欲しい資料
RailsでWebアプリケーションを作る上で次のサイトを必ず参照して欲しいとのことです。
- Railsセキュリティガイド
- OWASP TOP 10
- SANS/CWE TOP 25

*注
ここでのバリデーションとはRailsにおけるvalidatesメソッドが行うようなバリデーションに限らず、より広い意味の「入力チェック」の事を指しています。

